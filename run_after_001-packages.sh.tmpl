#!/bin/bash
# Install user-level packages after dotfiles are deployed
# Pure bash â€” no ansible dependency needed

set -euo pipefail

#############################################
# Load package manager environments
#############################################

export PATH="${HOME}/.local/bin:${PATH}"

#############################################
# Brew bundle (skip in container mode)
#############################################
# Homebrew
# if [ -d /opt/homebrew ]; then
#   eval "$(/opt/homebrew/bin/brew shellenv)"
# elif [ -d /usr/local/Homebrew ]; then
#   eval "$(/usr/local/bin/brew shellenv)"
# elif [ -d /home/linuxbrew/.linuxbrew ]; then
#   eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
# fi

# BREWFILE="${HOME}/.config/brew/Brewfile"
# if command -v brew >/dev/null 2>&1 && [ -f "$BREWFILE" ]; then
#   brew bundle --file="$BREWFILE" --quiet --no-lock 2>&1 | grep -i "^using\|^installing\|error\|fail" || true
# fi

#############################################
# Mise install (skip in container mode)
#############################################
# Mise
# if [ -f "${HOME}/.local/bin/mise" ]; then
#   eval "$("${HOME}/.local/bin/mise" activate bash)"
# fi

# if command -v mise >/dev/null 2>&1; then
#   mise install --yes --quiet 2>/dev/null || true
#   mise trust --all 2>/dev/null || true
# fi

#############################################
# Nix flake install (skip in container mode)
#############################################
# FLAKE_DIR="${HOME}/.config/nix"
# if command -v nix >/dev/null 2>&1 && [ -f "${FLAKE_DIR}/flake.nix" ]; then
#   nix profile install "${FLAKE_DIR}#homies" --impure 2>&1 | tail -5 || true
# fi

#############################################
# Shell installers
#############################################
INSTALLERS="${HOME}/.shell.installers"
if [ -f "$INSTALLERS" ]; then
  . "$INSTALLERS"
  install_zsh_manager			2>/dev/null || true
  install_tmux_manager		2>/dev/null || true
  install_theme_manager		2>/dev/null || true
fi
